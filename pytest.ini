[pytest]
DJANGO_SETTINGS_MODULE = config.settings.testing
python_files = tests.py test_*.py *_tests.py

# Note: Parallel execution (-n auto) configured in pyproject.toml
# To disable xdist temporarily: pytest -n 0
addopts =
    --reuse-db
    --maxfail=5
    --tb=short
    -ra
    --strict-markers

markers =
    # Test categories by database/browser requirements
    unit: Unit tests (no database)
    integration: Integration tests (database required)
    e2e: End-to-end tests (browser required)
    slow: Slow tests (>1 second)

    # Domain-specific markers
    calculations: Tests for allocation/calculation engine logic
    domain: Tests for domain models and business rules
    views: Tests for Django views and templates
    golden: Golden reference tests with known expected values
    models: Tests for Django model layer
    services: Tests for service layer
    forms: Tests for Django forms
    templatetags: Tests for template tags and filters
    presentation: Tests for presentation/formatting layer
    middleware: Tests for Django middleware

    # E2E subcategories
    display: Critical display validation tests (NaN, formatting)
    edge_case: Edge case and boundary condition tests (E2E)
    journey: Complete user journey tests
    visual: Visual regression tests

    # Special categories
    edge_cases: Edge case and boundary condition tests
    performance: Performance and benchmark tests
