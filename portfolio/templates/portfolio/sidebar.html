{% load humanize %}
{% load portfolio_filters %}

<div class="sidebar">
    <div class="sidebar-header mb-3 d-flex justify-content-between align-items-center">
        <div>
            <h5 class="fw-bold mb-0">Net Worth</h5>
            <h3 class="fw-bold mb-0">${{ sidebar_data.grand_total|floatformat:0|intcomma }}</h3>
        </div>
        <button class="btn btn-sm btn-outline-secondary d-none d-md-block" onclick="document.getElementById('sidebar-toggle').click()" title="Collapse Sidebar">
            <i class="bi bi-chevron-left"></i>
        </button>
    </div>

    <div class="accordion" id="sidebarAccordion">
        {% for group_name, group in sidebar_data.groups.items %}
        <div class="accordion-item border-0 mb-2">
            <h2 class="accordion-header" id="heading{{ forloop.counter }}">
                <button
                    class="accordion-button d-flex justify-content-between align-items-center bg-light rounded"
                    type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ forloop.counter }}"
                    aria-expanded="true"
                    aria-controls="collapse{{ forloop.counter }}">
                    <span class="fw-bold me-auto">{{ group.label }}</span>
                    <span class="fw-bold text-success">${{ group.total|floatformat:0|intcomma }}</span>
                </button>
            </h2>
            <div id="collapse{{ forloop.counter }}"
                class="accordion-collapse collapse show"
                aria-labelledby="heading{{ forloop.counter }}">
                <div class="accordion-body p-0">
                    <ul class="list-group list-group-flush">
                        {% for account in group.accounts %}
                        <a href="{% url 'portfolio:account_holdings' account.id %}" class="text-decoration-none text-dark">
                        <li class="list-group-item border-0 d-flex justify-content-between align-items-center ps-4">
                            <div>
                                <div class="fw-bold">{{ account.name }}</div>
                                <div class="text-muted small">{{ account.institution }}</div>
                            </div>
                            <div class="text-end">
                                <div class="text-success small fw-bold">
                                    ${{ account.total|floatformat:0|intcomma }}
                                </div>
                                <div class="text-muted small" style="font-size: 0.75em;" title="Absolute Deviation vs Target">
                                    drift: {{ account.absolute_deviation_pct|accounting_percent:1 }}
                                </div>
                            </div>
                        </li>
                        </a>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
