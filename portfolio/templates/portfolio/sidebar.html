{% load humanize %}
{% load portfolio_extras %}

<div class="sidebar">
    <div class="sidebar-header mb-3">
        <h5 class="fw-bold">Net Worth</h5>
        <h3 class="fw-bold">${{ sidebar_data.grand_total|floatformat:0|intcomma }}</h3>
    </div>

    <div class="accordion" id="sidebarAccordion">
        {% for group_name, group in sidebar_data.groups.items %}
        <div class="accordion-item border-0 mb-2">
            <h2 class="accordion-header" id="heading{{ forloop.counter }}">
                <button
                    class="accordion-button d-flex justify-content-between align-items-center bg-light rounded"
                    type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ forloop.counter }}"
                    aria-expanded="true"
                    aria-controls="collapse{{ forloop.counter }}">
                    <span class="fw-bold me-auto">{{ group.label }}</span>
                    <span class="fw-bold text-success">${{ group.total|floatformat:0|intcomma }}</span>
                </button>
            </h2>
            <div id="collapse{{ forloop.counter }}"
                class="accordion-collapse collapse show"
                aria-labelledby="heading{{ forloop.counter }}">
                <div class="accordion-body p-0">
                    <ul class="list-group list-group-flush">
                        {% for account in group.accounts %}
                        <a href="{% url 'portfolio:account_holdings' account.id %}" class="text-decoration-none text-dark">
                        <li class="list-group-item border-0 d-flex justify-content-between align-items-center ps-4">
                            <div>
                                <div class="fw-bold">{{ account.name }}</div>
                                <div class="text-muted small">{{ account.institution }}</div>
                            </div>
                            <div class="text-end">
                                <div class="text-success small fw-bold">
                                    ${{ account.total|floatformat:0|intcomma }}
                                </div>
                                {% if account.absolute_deviation_pct > 0 %}
                                <div class="text-muted small" style="font-size: 0.75em;" title="Absolute Deviation vs Target">
                                    dev: {{ account.absolute_deviation_pct|accounting_percent:1 }}
                                </div>
                                {% endif %}
                            </div>
                        </li>
                        </a>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<style>
    .sidebar {
        background-color: #f8f9fa;
        height: 100%;
        padding: 1rem;
        border-right: 1px solid #dee2e6;
    }

    .accordion-item {
        background-color: #ffffff;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        border: 1px solid rgba(0,0,0,0.05);
    }

    .accordion-button {
        background-color: #ffffff;
        color: #212529;
        box-shadow: none;
    }

    .accordion-button:not(.collapsed) {
        background-color: #f1f3f5;
        color: #212529;
        box-shadow: none;
        border-bottom: 1px solid #dee2e6;
    }

    .accordion-button:focus {
        box-shadow: none;
        border-color: rgba(0, 0, 0, .125);
    }

    .accordion-button::after {
        margin-left: 0.5rem;
    }

    .list-group-item {
        background-color: transparent;
    }

    .list-group-item:hover {
        background-color: #f8f9fa;
    }
</style>